"function"===typeof importScripts&&(importScripts("checksol.min.js","localSearch.min.js","knapsackDP.min.js"),this.onmessage=function(g){var b=g.data.gv;maxiter=g.data.maxiter;alpha=g.data.alpha;minalpha=g.data.minalpha;n=b.n;m=b.m;c=b.c;req=b.req;cap=b.cap;sol=b.sol;solbest=b.solbest;startTime=b.startTime;endTime=b.endTime;timeDiff=b.timeDiff;zlbBest=zub=Number.MAX_VALUE;jInstance=b.jInstance;EPS=.001;console.log("[WW] "+JSON.stringify(g.data));switch(g.data.func){case "run_lagrAss":console.log(":: run_lagrAss",
maxiter,alpha,minalpha);run_lagrAss();postMessage({task:"run_lagrAss",complete:!0});break;case "run_lagrCap":console.log(":: run_lagrCap",maxiter,alpha,minalpha);run_lagrCap();postMessage({task:"run_lagrCap",complete:!0});break;default:console.log("default:  ==>  NO task executed!")}});
function run_lagrCap(){0>maxiter&&(maxiter=Number.MAX_VALUE);postMessage({task:"lagrCap",complete:!1,message:"Starting relax capacities, n="+n+"\n"});startTime=new Date;lagrNoCap(maxiter,alpha,minalpha);endTime=new Date;timeDiff=endTime-startTime;console.log("LagrCap, optimization OK");console.log("LagrCap, zlb= "+zlbBest+" zub= "+zub+" t.cpu "+timeDiff+" ms");postMessage({task:"lagrCap",complete:!1,message:"LagrCap, zlb= "+zlbBest+" zub= "+zub+" t.cpu "+timeDiff+" ms"});zlbBest=zub=Number.MAX_VALUE;
solbest=sol=null}
function run_lagrAss(){0>maxiter&&(maxiter=Number.MAX_VALUE);postMessage({task:"lagrAss",complete:!1,message:"Starting relaxed assignments, n="+n+"\n"});startTime=new Date;lagrNoAss(maxiter,alpha,minalpha);endTime=new Date;timeDiff=endTime-startTime;console.log("LagrAss, optimization OK");console.log("LagrAss, zlb= "+zlbBest+" zub= "+zub+" t.cpu "+timeDiff+" ms");postMessage({task:"lagrAss",complete:!1,message:"LagrAss, zlb= "+zlbBest+" zub= "+zub+" t.cpu "+timeDiff+" ms"});zlbBest=zub=Number.MAX_VALUE;
solbest=sol=null}function writeIterData(g,b,d,a,e,f,h){console.log("iter "+g+") zlbbest="+zlbBest+" zlb = "+zlb+" zub = "+zub+" alpha = "+d)}
function lagrNoCap(g,b,d){var a;void 0===zub&&(zub=Number.MAX_VALUE);var e,f,h=Array(m),k=Array(m);sol=Array(n);solbest=Array(n);zlbBest=Number.MIN_VALUE;for(e=0;e<m;e++)h[e]=0;for(a=0;b>d&&a<g;){var l=subproblem_withass(h,k);var p=checkSol(l);if(p==zlb||1>zub-zlbBest){console.log("[lagrNoCap] Got the optimum!!! zopt="+zub);postMessage({task:"lagrCap",complete:!1,message:"[lagrNoCap] Got the optimum!!! zopt="+zub+" iter="+a+"\n"});break}else p=fillVar(l),p<10*zlb&&(sol=l.slice(),opt10(c));for(e=f=
0;e<m;e++)f+=k[e]*k[e];fakeZub=Math.min(p,1.2*zlb);fakeZub=Math.max(fakeZub,zlb+1);f=b*(fakeZub-zlb)/f;0==a%100&&writeIterData(a,p,b,l,k,h,f);for(e=0;e<m;e++)h[e]=Math.min(0,h[e]+f*k[e]);a++;0==a%40&&(b*=.97)}return zub}
function subproblem_withass(g,b){var d,a,e;for(a=0;a<n;a++)sol[a]=-1;for(d=zlb=0;d<m;d++)b[d]=cap[d],zlb+=cap[d]*g[d];for(a=0;a<n;a++){var f=e=Number.MAX_VALUE;for(d=0;d<m;d++)c[d][a]-req[d][a]*g[d]<e&&(e=c[d][a]-req[d][a]*g[d],f=d);sol[a]=f;b[f]-=req[f][a];zlb+=e}zlb>zlbBest&&(zlbBest=zlb);return sol}function lagrNoAss(g,b,d){var a,e,f=Array(n),h=Array(n);sol=Array(n);solbest=Array(n);void 0===zub&&(zub=Number.MAX_VALUE);zlbBest=Number.MIN_VALUE;for(a=0;a<n;a++)f[a]=0;for(a=0;b>d&&a<g;){var k=subproblem_withcap(f,h);var l=checkSol(k);if(l==zlb||1>zub-zlbBest){console.log("[lagrNoAss] Got the optimum!!! zopt="+zub);postMessage({task:"lagrAss",complete:!1,message:"[lagrNoAss] Got the optimum!!! zopt="+zub+" iter="+a+"\n"});break}else{var p=fillVar(k);-1==a%10&&console.log("[lagrNoAss] iter="+a+
" zlb="+zlb+" zcurr="+p+" zub="+zub);p<10*zlb&&(sol=k.slice(),opt10(c))}for(l=e=0;l<n;l++)e+=h[l]*h[l];fakeZub=Math.min(p,1.2*zlb);fakeZub=Math.max(fakeZub,zlb+1);e=b*(fakeZub-zlb)/e;0==a%100&&writeIterData(a,p,b,k,h,f,e);for(l=0;l<n;l++)f[l]+=e*h[l];a++;0==a%40&&(b*=.9)}return zub}
function subproblem_withcap(g,b){var d,a;for(a=zlb=0;a<n;a++)sol[a]=-1,b[a]=1;var e=Array(n),f=Array(n),h=Array(n);for(d=0;d<m;d++){for(a=0;a<n;a++)e[a]=req[d][a],f[a]=-c[d][a]+g[a],h[a]=0;zlb-=KDynRecur(cap[d],e,f,h);for(a=0;a<n;a++)0<h[a]&&(sol[a]=d,--b[a])}for(a=0;a<n;a++)zlb+=g[a];zlb>zlbBest&&(zlbBest=zlb);return sol}function fillVar(g){var b,d,a,e=Array(m),f=Array(n);for(b=0;b<m;b++)e[b]=cap[b];for(b=0;b<n;b++)f[b]=g[b];for(d=0;d<n;d++)0<=f[d]&&e[f[d]]>=req[f[d]][d]?e[f[d]]-=req[f[d]][d]:f[d]=-1;for(d=a=0;d<n;d++)if(0<=f[d])a+=c[f[d]][d];else{var h=Number.MAX_VALUE;var k=-1;for(b=0;b<m;b++)e[b]>=req[b][d]&&req[b][d]<h&&(h=req[b][d],k=b);if(0>k)return a=Number.MAX_VALUE;f[d]=k;e[k]-=req[k][d];a+=c[k][d]}if(a<zub){for(b=0;b<n;b++)solbest[b]=f[b];zub=a;console.log("[fillVar] -------- zub improved! "+zub)}for(b=0;b<n;b++)g[b]=f[b];return a};
